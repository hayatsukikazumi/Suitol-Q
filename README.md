# Suitol-Q
すいとーるQ（Excelシートに書かれたデータからSQLクエリを生成するExcelマクロ）

## 何のソフトなの？

このExcelマクロは、Excelシートに書かれたDBデータの内容を、SQLのINSERT、
UPDATE、DELETE文に変換します。

* Excelシートのデータ型によって文字列、数値、日付、NULLを自動識別します。
* 最大10テーブルに対し、一度に出力指定が可能です。
* 出力対象列、出力対象行の選択が可能です。

## 動作条件

* Microsoft Excel 2007以上をインストールしたマシン
（Excel バージョン2208で動作確認）

## 使い方

1. 以下の書式にしたがって、SQL作成元となるExcelファイルを作成する。
    * ワークシート名＝テーブル名を推奨。
        * ワークシート名とテーブル名が異なる場合は「入力項目」章を参照
    * 同時に複数テーブルに対する処理を行う場合は、1ファイルに複数ワークシート
    を作成する。
    * ワークシートの1行目は列名を記述する。
    * SQLを出力させたくない行　→　当該行を非表示にする。
    * SQLを出力させたくない列　→　当該列を非表示にする。
    * INSERTに限ってSQLを出力させたくない列　→　当該列名に下線を引く。
        * 自動採番で設定される列に指定します。
    * UPDATEやDELETEの時に検索条件にしたい列　→　列名を斜体にしておく。
        * 主キーや代替キー列に指定します。
    * 文字列として数字を登録する　→　各セルの表示形式を「文字列」にしておく。
    * 日付または日時として登録する　→　各セルの表示形式を日付形式、または
    ユーザー定義で日付フォーマットを設定しておく。
2. 「SUITOL_Q.xlsm」 ファイルを開く。（セキュリティ センターのマクロの設定で
「すべてのマクロを 有効にする」を指定のこと）
3. Mainワークシートの6行目以下に、各項目を入力する。
    * 詳細は「入力項目」章を参照
4. Mainワークシートの「作成実行」ボタンを押す。
5. DestワークシートのA列に結果が反映されるので、内容をコピーしテキストファイル
や他のExcelファイルにペーストして利用する。

## 入力項目

<dl>
<dt>SQL作成元Excelファイル</dt>
<dd>SQL作成対象のExcelファイルをフルパスで指定します。「ファイル選択」ボタンを
押すとファイルダイアログから指定できます。（必須）</dd>
<dt>SQL作成元シート</dt>
<dd>SQL作成元Excelファイルのワークシート名を指定します（最大10シート）。
同じテーブルを複数回指定できます。（必須）</dd>
<dt>SQL作成対象テーブル</dt>
<dd>SQLを作成したいワークシート名とテーブル名が異なる場合に指定します。
省略時は上の行で指定したワークシート名＝テーブル名となります。（任意）</dd>
<dt>INSERT/UPDATE/DELETE</dt>
<dd>出力するSQLの種類を指定します。「INSERT式」のように「式」がある項目は、
当該セルを参照するSQL式が出力される「Excelの数式」を生成します。（必須）</dd>
<dt>スキーマ名</dt>
<dd>指定した場合、SQLに「スキーマ名.テーブル名」と出力されます。（任意）</dd>
<dt>コマンド区切り</dt>
<dd>OracleのSQL*Plusにおける「;」のように、コマンド区切り文字列の指定が必要な
場合に指定します。（任意）</dd>
</dl>

## 制限事項

* もしトータルの出力結果が1048576行を超えるとエラーになります。
件数の多いデータはSQL作成元Excelファイル側で出力しない行を非表示にするなどの
対処を行ってください。
* 値が日付や日時形式の場合、出力されるSQLは「値が日付／日時形式に整形された
文字列」になり、SQLの日付関数は出力されません。
* SQL作成元Excelファイルのセルの表示形式が行によって異なる場合、セル単位で
値の形式を判断しますので実際のテーブルの値形式と整合性が取れないSQL文が
出力されることがあります。
* INSERT/UPDATE/DELETE の項目で「INSERT式」「UPDATE式」「DELETE式」を選んだ
場合、「X="INSERT INTO～」のように出力されます。また、値のセル参照は2行目に
なりますので、出力されたセルを作成元Excelファイルにペースト後、最初の「X」を
削除してから使用してください。
* INSERT式、UPDATE式、DELETE式で出力されるExcelの数式では、数式長節約のため
文字列のNULL判別を行っていません。また、NULLしか入っていない列については
列の型を誤認識する場合があります。

## 著作権・免責事項

このプログラムの著作権は、私（はやつきかづみ）が所有しております。
また、このプログラムを使用したことによる不利益・被害・損失等に関して、私
（はやつきかづみ）は一切責任を負いません。各自の自己責任でお願いします。

## 変更履歴

* 2021/07/18 Ver. 1.0.0を公開
* 2022/09/19 Ver. 1.1.0を公開
    * SQL作成元シート、SQL作成対象テーブルを別々に指定可能にした
    * 「ファイル選択」ボタンの追加
    * セル内容が空でかつ文字列型の場合、SQLにはNULLを出力するようにした

--------
Copyright(c) はやつきかづみ（早月加積） 2021

zzzszoo200@gmail.com